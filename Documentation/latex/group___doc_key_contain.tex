\hypertarget{group___doc_key_contain}{}\section{Key Container}
\label{group___doc_key_contain}\index{Key Container@{Key Container}}


A container that loads each key object and manages them.  


\subsection*{Modules}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group___key_contain_const}{Constants}
\item 
\hyperlink{group___key_contain_handlers}{Event Handlers}
\item 
\hyperlink{group___key_contain_priv_func}{Private Functions}
\item 
\hyperlink{group___key_contain_priv_var}{Private Variables}
\item 
\hyperlink{group___key_contain_unity}{Unity Functions}
\item 
\hyperlink{group___key_contain_pub_var}{Variables}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
A container that loads each key object and manages them. 

\hypertarget{group___doc_key_contain_DocKeyContainConst}{}\subsection{Constants}\label{group___doc_key_contain_DocKeyContainConst}
These are constants used for creating the keys. ~\newline
 \hyperlink{group___key_contain_const}{More details}.\hypertarget{group___doc_key_contain_DocKeyContainPubVar}{}\subsection{Public Variables}\label{group___doc_key_contain_DocKeyContainPubVar}
These are variables other classes/the inspector can use to interact with the key container. ~\newline
 \hyperlink{group___key_contain_pub_var}{More details}.\hypertarget{group___doc_key_contain_DocKeyContainPrivVar}{}\subsection{Private Variables}\label{group___doc_key_contain_DocKeyContainPrivVar}
These are variables used to manage the keys. ~\newline
 \hyperlink{group___key_contain_priv_var}{More details}.\hypertarget{group___doc_key_contain_DocKeyContainUnity}{}\subsection{Unity Functions}\label{group___doc_key_contain_DocKeyContainUnity}
Built-\/in Unity functions that are automatically called. ~\newline
 \hyperlink{group___key_contain_unity}{More details}.\hypertarget{group___doc_key_contain_DocKeyContainPrivFunc}{}\subsection{Private Functions}\label{group___doc_key_contain_DocKeyContainPrivFunc}
Functions used internally by the \hyperlink{class_key_container}{Key\+Container} ~\newline
 \hyperlink{group___key_contain_priv_func}{More details}.\hypertarget{group___doc_key_contain_DocKeyContainHandlers}{}\subsection{Doc\+Key\+Contain\+Handlers}\label{group___doc_key_contain_DocKeyContainHandlers}
Functions used internally by the \hyperlink{class_key_container}{Key\+Container} to handle events. ~\newline
 \hyperlink{group___key_contain_handlers}{More details}.\hypertarget{group___doc_key_contain_DocKeyContainCode}{}\subsection{Code}\label{group___doc_key_contain_DocKeyContainCode}

\begin{DoxyCodeInclude}
1 \textcolor{keyword}{using} \hyperlink{namespace_system}{System};
2 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Collections;
3 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Collections.Generic;
4 \textcolor{keyword}{using} \hyperlink{namespace_unity_engine}{UnityEngine};
5 \textcolor{keyword}{using} \hyperlink{namespace_unity_engine}{UnityEngine}.Assertions;
6 \textcolor{keyword}{using} \hyperlink{namespace_unity_engine}{UnityEngine}.Events;
7 \textcolor{comment}{}
8 \textcolor{comment}{/** }
9 \textcolor{comment}{ * @class KeyContainer}
10 \textcolor{comment}{ * @brief A container that loads each key object and manages them.}
11 \textcolor{comment}{*/}
12 \textcolor{keyword}{public} \textcolor{keyword}{class }\hyperlink{class_key_container}{KeyContainer} : MonoBehaviour \{
13 
14     \textcolor{comment}{/*************************************************************************/}\textcolor{comment}{/** }
15 \textcolor{comment}{    * @defgroup KeyContainConst Constants}
16 \textcolor{comment}{    * @ingroup DocKeyContain}
17 \textcolor{comment}{    * These are constants used for creating the keys.}
18 \textcolor{comment}{    * @\{}
19 \textcolor{comment}{    ****************************************************************************/}
20     \textcolor{keyword}{private} \textcolor{keyword}{const} \textcolor{keywordtype}{int} NUM\_KEYS = 25; \textcolor{comment}{//!< The default number of keys shown.}
21 \textcolor{comment}{}    \textcolor{keyword}{private} \textcolor{keyword}{const} \textcolor{keywordtype}{string} BLACK\_KEY\_PATH = \textcolor{stringliteral}{"Graphics/Prefabs/BlackKeyPrefab"}; \textcolor{comment}{//!< The path to load the
       prefab for the black keys.}
22 \textcolor{comment}{}    \textcolor{keyword}{private} \textcolor{keyword}{const} \textcolor{keywordtype}{string} LESSON\_MARKER\_PATH = \textcolor{stringliteral}{"Audio/Prefabs/LessonMarkerPrefab"}; \textcolor{comment}{//!< The path to load a
       lesson marker.}
23 \textcolor{comment}{}    \textcolor{keyword}{private} \textcolor{keyword}{const} \textcolor{keywordtype}{string} VIM\_PATH = \textcolor{stringliteral}{"Audio/Prefabs/VirtualInstrumentManagerPrefab"}; \textcolor{comment}{//!< The path to load
       the @link VIM Virtual Instrument Manager@endlink.}
24 \textcolor{comment}{}    \textcolor{keyword}{private} \textcolor{keyword}{const} \textcolor{keywordtype}{string} WHITE\_KEY\_PATH = \textcolor{stringliteral}{"Graphics/Prefabs/WhiteKeyPrefab"}; \textcolor{comment}{//!< The path to load the
       prefab for the white keys.}
25 \textcolor{comment}{}
26     \textcolor{comment}{// TODO: Fill this out.}
27     \textcolor{comment}{//private const string[] TESTING\_KEYS = [ "KEY\_1", "KEY\_2", ... ]}
28 
29     \textcolor{comment}{/*************************************************************************/}\textcolor{comment}{/** }
30 \textcolor{comment}{    * @\}}
31 \textcolor{comment}{    * @defgroup KeyContainPubVar Variables}
32 \textcolor{comment}{    * @ingroup DocKeyContain}
33 \textcolor{comment}{    * These are variables other classes/the inspector can use to interact with the key container.}
34 \textcolor{comment}{    * @\{}
35 \textcolor{comment}{    ****************************************************************************/}
36     \textcolor{keyword}{public} \textcolor{keywordtype}{bool} EnableAudio = \textcolor{keyword}{false};
37 
38     \textcolor{comment}{/*************************************************************************/}\textcolor{comment}{/** }
39 \textcolor{comment}{    * @\}}
40 \textcolor{comment}{    * @defgroup KeyContainPrivVar Private Variables}
41 \textcolor{comment}{    * @ingroup DocKeyContain}
42 \textcolor{comment}{    * These are variables used to manage the keys.}
43 \textcolor{comment}{    * @\{}
44 \textcolor{comment}{    ****************************************************************************/}
45     \textcolor{keyword}{private} \textcolor{keywordtype}{float} mBlackKeyWidth = 0f; \textcolor{comment}{//!< The width of a black key.}
46 \textcolor{comment}{}    \textcolor{keyword}{private} \textcolor{keywordtype}{float} mWhiteKeyWidth = 0f; \textcolor{comment}{//!< The width of a white key.}
47 \textcolor{comment}{}    \textcolor{keyword}{private} GameObject[] mKeyObjects = null; \textcolor{comment}{//!< The keys held in the container. Need to update this once
       the classes are combined.}
48 \textcolor{comment}{}    \textcolor{keyword}{private} GameObject[] mLessonMarkers = null; \textcolor{comment}{//!< Lesson markers for showing which key to hit. Just
       testing this for now to see if I can get the audio timing right.}
49 \textcolor{comment}{}    \textcolor{keyword}{private} \textcolor{keywordtype}{int} mNumWhiteKeys = 0; \textcolor{comment}{//!< The number of white keys being shown. Used for positioning.}
50 \textcolor{comment}{}    \textcolor{keyword}{private} \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH}[] \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches} = null; \textcolor{comment}{//!< The pitches that
       are represented by the keyboard.}
51 \textcolor{comment}{}    \textcolor{keyword}{private} \hyperlink{class_virtual_instrument_manager}{VirtualInstrumentManager} mVIM = null; \textcolor{comment}{//!< The bridge to the audio
       code.}
52 \textcolor{comment}{}
53     \textcolor{comment}{/*************************************************************************/}\textcolor{comment}{/** }
54 \textcolor{comment}{    * @\}}
55 \textcolor{comment}{    * @defgroup KeyContainUnity Unity Functions}
56 \textcolor{comment}{    * @ingroup DocKeyContain}
57 \textcolor{comment}{    * Built-in Unity functions that are automatically called.}
58 \textcolor{comment}{    * @\{}
59 \textcolor{comment}{    *****************************************************************************/}
60     \textcolor{comment}{}
61 \textcolor{comment}{    /**}
62 \textcolor{comment}{     * @brief Initializes the KeyContainer and loads each key.}
63 \textcolor{comment}{    */}
64     \textcolor{keywordtype}{void} \hyperlink{group___key_contain_unity_ga9e307b409b1e07b2be51a21afe5d7379}{Awake}()
65     \{
66         \textcolor{comment}{// Initialize the represented pitches. Default is from C3 to C5.}
67         \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches} = \textcolor{keyword}{new} \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH}[
      \hyperlink{group___key_contain_const_gaa8fe6473e6396976e52c5793f027380e}{NUM\_KEYS}];
68         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i = 0; i < \hyperlink{group___key_contain_const_gaa8fe6473e6396976e52c5793f027380e}{NUM\_KEYS}; i++ )
69         \{
70             \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] = (\hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH})( (\textcolor{keywordtype}{int})
      \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH}.C3 + i );
71             \textcolor{keywordflow}{if}( !\hyperlink{class_music}{Music}.\hyperlink{group___music_stat_func_gacc2c1a66df7197225f61c5737f794065}{IsPitchABlackKey}( 
      \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) )
72             \{
73                 mNumWhiteKeys++;
74             \}
75         \}
76 
77         \textcolor{comment}{// Get the width of each key.}
78         mWhiteKeyWidth = Resources.Load<GameObject>( \hyperlink{group___key_contain_const_ga8ce7e53d5c067095ee26b96fcc522584}{WHITE\_KEY\_PATH} ).GetComponent<Renderer>(
      ).bounds.size.z;
79         mWhiteKeyWidth += ( mWhiteKeyWidth / 10f );
80         mBlackKeyWidth = Resources.Load<GameObject>( \hyperlink{group___key_contain_const_gac968b0d398c545a13abad255d8287825}{BLACK\_KEY\_PATH} ).GetComponent<Renderer>(
      ).bounds.size.z;
81         Debug.Log( \textcolor{stringliteral}{"White key width: "} + mWhiteKeyWidth.ToString() );
82         Debug.Log( \textcolor{stringliteral}{"Black key width: "} + mBlackKeyWidth.ToString() );
83 
84         \textcolor{comment}{// Load the keys.}
85         \hyperlink{group___key_contain_priv_func_ga65f79700f265d2223681ac95981ab4a3}{LoadKeys}();      
86     \}
87     
88     \textcolor{comment}{// Update is called once per frame}
89     \textcolor{keywordtype}{void} \hyperlink{group___key_contain_unity_gae0e513a4ef9fd25c1e0f5f3bc53d9b5c}{Update}()
90     \{
91         \textcolor{comment}{// See if we need to load the audio.}
92         \textcolor{keywordflow}{if}( mVIM == null && EnableAudio )
93         \{
94             \textcolor{comment}{// Load the prefab}
95             GameObject temp = Instantiate( Resources.Load<GameObject>( VIM\_PATH ) );
96             Assert.IsNotNull( temp, \textcolor{stringliteral}{"Failed to load VirtualInstrumentManagerPrefab!"} );
97 
98             \textcolor{comment}{// Get the VIM from the prefab.}
99             temp.name = \textcolor{stringliteral}{"VirtualInstrumentManager"};
100             mVIM = temp.GetComponent<\hyperlink{class_virtual_instrument_manager}{VirtualInstrumentManager}>();
101             Assert.IsNotNull( mVIM, \textcolor{stringliteral}{"Failed to get the VirtualInstrumentManager component!"} );
102 
103             \textcolor{comment}{// Add the listener for note range changes.}
104             mVIM.\hyperlink{group___v_i_m_events_gab6fa99d08e8466406835b9fc4ff859f1}{ChangeNoteRange}.AddListener( 
      \hyperlink{group___key_contain_handlers_ga0d82098e4f886f77a33f9d5ed13fe195}{HandleChangeNoteRangeEvent} );
105             mVIM.\hyperlink{group___v_i_m_events_gae450bdba9c513ab4e43f69def50fa84d}{PlaySong}.AddListener( \hyperlink{group___key_contain_handlers_ga894c823059c5268af0954f83c04036ed}{HandlePlaySongEvent} );
106 
107 \textcolor{preprocessor}{            #if DEBUG\_MUSICAL\_TYPING}
108                 \textcolor{comment}{// Disable Musical Typing}
109                 mVIM.\hyperlink{group___v_i_m_pub_func_gae6701458a23a3f14db90501f871d4d0d}{GetMusicalTypingHandler}().
      \hyperlink{group___mus_typ_pub_var_ga09a764161d537b31fac1a64ee5d39625}{MusicalTypingEnabled} = \textcolor{keyword}{false};
110 \textcolor{preprocessor}{            #endif}
111         \}
112         \textcolor{comment}{// See if we need to unload the audio.}
113         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( !EnableAudio && mVIM != null )
114         \{
115             DestroyImmediate( mVIM.gameObject, \textcolor{keyword}{false} );
116             mVIM = null;
117         \}
118     \}
119 
120     \textcolor{comment}{/*************************************************************************/}\textcolor{comment}{/** }
121 \textcolor{comment}{    * @\}}
122 \textcolor{comment}{    * @defgroup KeyContainPrivFunc Private Functions}
123 \textcolor{comment}{    * @ingroup DocKeyContain}
124 \textcolor{comment}{    * Functions used internally by the KeyContainer}
125 \textcolor{comment}{    * @\{}
126 \textcolor{comment}{    *****************************************************************************/}
127 \textcolor{comment}{}
128 \textcolor{comment}{    /**}
129 \textcolor{comment}{     * @brief Clears the keyboard}
130 \textcolor{comment}{    */}
131     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_priv_func_ga679f5ca9d6b1505180e90ee00bbfe616}{ClearKeyboard}()
132     \{
133         Assert.IsNotNull( mKeyObjects, \textcolor{stringliteral}{"Tried to clear the keyboard, but it was already clear!"} );
134 
135         \textcolor{comment}{// Destroy the key objects.}
136         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i = 0; i < \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}.Length; i++ )
137         \{
138             DestroyImmediate( mKeyObjects[i], \textcolor{keyword}{false} );
139         \}
140 
141         \textcolor{comment}{// Set the array to null.}
142         mKeyObjects = null;
143 
144         \textcolor{comment}{// Destroy the key objects.}
145         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i = 0; i < \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}.Length; i++ )
146         \{
147             DestroyImmediate( mLessonMarkers[i], \textcolor{keyword}{false} );
148         \}
149         mLessonMarkers = null;
150 
151         \textcolor{comment}{// Clean up.}
152         GC.Collect();
153         Resources.UnloadUnusedAssets();
154     \}
155 \textcolor{comment}{}
156 \textcolor{comment}{    /**}
157 \textcolor{comment}{     * @brief Loads the keys in the container.}
158 \textcolor{comment}{     * }
159 \textcolor{comment}{     * This function loads each key and sets their position and values.}
160 \textcolor{comment}{    */}
161     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_priv_func_ga65f79700f265d2223681ac95981ab4a3}{LoadKeys}()
162     \{
163         \textcolor{comment}{// Destroy the previous keys if needed.}
164         \textcolor{keywordflow}{if}( mKeyObjects != null )
165         \{
166            \textcolor{comment}{// ClearKeyboard();}
167         \}
168 
169         \textcolor{comment}{// Load the keys.}
170         mKeyObjects = \textcolor{keyword}{new} GameObject[\hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}.Length];
171         mLessonMarkers = \textcolor{keyword}{new} GameObject[\hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}.Length];
172         Vector3 keyPosition = Vector3.zero;
173         \textcolor{keywordtype}{int} whiteKeyIndex = -1 * ( mNumWhiteKeys / 2 );
174         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i = 0; i < \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}.Length; i++ )
175         \{
176 
177             \textcolor{comment}{// Handle if the key is a black key.}
178             \textcolor{keywordflow}{if}( \hyperlink{class_music}{Music}.\hyperlink{group___music_stat_func_gacc2c1a66df7197225f61c5737f794065}{IsPitchABlackKey}( \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) )
179             \{
180                 \textcolor{comment}{// Make an empty black key to help initialize this one.}
181                 \hyperlink{class_black_key}{BlackKey} key = null;
182 
183                 \textcolor{comment}{// Create the black key object.}
184                 mKeyObjects[i] = Instantiate( Resources.Load<GameObject>( BLACK\_KEY\_PATH ) );
185                 Assert.IsNotNull( mKeyObjects[i], \textcolor{stringliteral}{"Failed to load prefab from "} + BLACK\_KEY\_PATH + \textcolor{stringliteral}{"!"} );
186                 mKeyObjects[i].name = \hyperlink{class_music}{Music}.\hyperlink{group___music_stat_func_ga85a22c905d56d4c5f4e62159bfecee8c}{NoteToString}( 
      \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) + \textcolor{stringliteral}{"Key"};
187 
188                 \textcolor{comment}{// Get the black key.}
189                 key = mKeyObjects[i].GetComponent<\hyperlink{class_black_key}{BlackKey}>();
190                 Assert.IsNotNull( key, \textcolor{stringliteral}{"Could not get a reference to the BlackKey script!"} );
191 
192                 \textcolor{comment}{// Set its pitch.}
193                 key.\hyperlink{group___black_key_pub_var_gad233c456182c9cef7c01486484940439}{Pitch} = \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i];
194 
195                 \textcolor{comment}{// Add listeners to its events.}
196                 key.\hyperlink{group___black_key_events_ga51f1badf49df0c54e31a20ba4b7abd6b}{BlackKeyPressed}.AddListener( 
      \hyperlink{group___key_contain_handlers_ga05cc2543fd9772b26e27bf4f6247ab47}{HandleBlackKeyPressed} );
197                 key.\hyperlink{group___black_key_events_ga2710bdaba16dbdb82c0d38f11ce642d8}{BlackKeyReleased}.AddListener( 
      \hyperlink{group___key_contain_handlers_ga5a0c5565c5ebc6026b3122f487e51704}{HandleBlackKeyReleased} );
198 
199                 \textcolor{comment}{// Set its position, which is determined by its joint. First, get the spring joint.}
200                 SpringJoint spring = mKeyObjects[i].GetComponent<SpringJoint>();
201                 Assert.IsNotNull( spring, \textcolor{stringliteral}{"Could not get spring joint of black key!"} );
202 
203                 \textcolor{comment}{// Get the offset position.}
204                 keyPosition = Vector3.zero;
205                 keyPosition.z += ( ( (float)( whiteKeyIndex - 1 ) * 
      \hyperlink{group___key_contain_priv_var_gae5b8787a5242834f99ad8072e7ea6004}{mWhiteKeyWidth} ) + ( mWhiteKeyWidth / 2f ) );
206 
207                 \textcolor{comment}{// Update the joint's connected anchor.}
208                 spring.autoConfigureConnectedAnchor = \textcolor{keyword}{false};
209                 spring.connectedAnchor += keyPosition;
210 
211                 \textcolor{comment}{// Set the new position.}
212                 keyPosition.y = mKeyObjects[i].transform.position.y;
213                 keyPosition.x = mKeyObjects[i].transform.position.x;
214                 mKeyObjects[i].transform.position = keyPosition;
215 
216                 \textcolor{comment}{// Put settings back on the spring joint.}
217                 spring.autoConfigureConnectedAnchor = \textcolor{keyword}{true};
218 
219                 \textcolor{comment}{// Set its place in the hierarchy.}
220                 mKeyObjects[i].transform.SetParent( transform, \textcolor{keyword}{true} );
221 
222                 Debug.Log( \textcolor{stringliteral}{"Position of key representing "} + \hyperlink{class_music}{Music}.
      \hyperlink{group___music_stat_func_ga85a22c905d56d4c5f4e62159bfecee8c}{NoteToString}( \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) + \textcolor{stringliteral}{":"} + keyPosition.ToString() );
223 
224                 \textcolor{comment}{// Set its parent.}
225                 key.\hyperlink{group___black_key_pub_func_ga49d807a46e36ba19211be329db1cbd2e}{SetParentContainer}( \textcolor{keyword}{this} );
226             \}
227 
228             \textcolor{comment}{// Handle if the key is a white key.}
229             \textcolor{keywordflow}{else}
230             \{
231                 \textcolor{comment}{// Make an empty black key to help initialize this one.}
232                 \hyperlink{class_white_key}{WhiteKey} key = null;
233 
234                 \textcolor{comment}{// Create the black key object.}
235                 mKeyObjects[i] = Instantiate( Resources.Load<GameObject>( WHITE\_KEY\_PATH ) );
236                 Assert.IsNotNull( mKeyObjects[i], \textcolor{stringliteral}{"Failed to load prefab from "} + WHITE\_KEY\_PATH + \textcolor{stringliteral}{"!"} );
237                 mKeyObjects[i].name = \hyperlink{class_music}{Music}.\hyperlink{group___music_stat_func_ga85a22c905d56d4c5f4e62159bfecee8c}{NoteToString}( 
      \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) + \textcolor{stringliteral}{"Key"};
238 
239                 \textcolor{comment}{// Get the black key.}
240                 key = mKeyObjects[i].GetComponent<\hyperlink{class_white_key}{WhiteKey}>();
241                 Assert.IsNotNull( key, \textcolor{stringliteral}{"Could not get a reference to the BlackKey script!"} );
242 
243                 \textcolor{comment}{// Set its pitch.}
244                 key.\hyperlink{group___white_key_pub_var_ga1ddd98b85ba069defc7cf47d25f625f4}{Pitch} = \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i];
245 
246                 \textcolor{comment}{// Add listeners to its events.}
247                 key.\hyperlink{group___white_key_events_gab84691fc1e9f7b62884589d1813433e2}{WhiteKeyPressed}.AddListener( 
      \hyperlink{group___key_contain_handlers_ga4e2c5e8be389a7514429910e7d61f028}{HandleWhiteKeyPressed} );
248                 key.\hyperlink{group___white_key_events_ga180e88cd7ab95af43231f53469e87830}{WhiteKeyReleased}.AddListener( 
      \hyperlink{group___key_contain_handlers_ga5b98b0105300225fd79638525ad3cb3c}{HandleWhiteKeyReleased} );
249 
250                 \textcolor{comment}{// Get the hinge joint.}
251                 HingeJoint hinge = mKeyObjects[i].GetComponent<HingeJoint>();
252                 hinge.autoConfigureConnectedAnchor = \textcolor{keyword}{false};
253 
254                 \textcolor{comment}{// Get the offset position.}
255                 keyPosition = Vector3.zero;
256                 keyPosition.z += ( (float)whiteKeyIndex * mWhiteKeyWidth );
257 
258                 \textcolor{comment}{// Set the hinge's position.}
259                 hinge.anchor += keyPosition;
260                 hinge.connectedAnchor += keyPosition;
261 
262                 \textcolor{comment}{// Set the key's position.}
263                 mKeyObjects[i].transform.position += keyPosition;
264                 hinge.autoConfigureConnectedAnchor = \textcolor{keyword}{true};
265 
266                 \textcolor{comment}{// Update the index of which white key we're on.}
267                 whiteKeyIndex++;
268 
269                 \textcolor{comment}{// Set its place in the hierarchy.}
270                 mKeyObjects[i].transform.SetParent( transform, \textcolor{keyword}{true} ); 
271 
272                 Debug.Log( \textcolor{stringliteral}{"Position of key representing "} + \hyperlink{class_music}{Music}.
      \hyperlink{group___music_stat_func_ga85a22c905d56d4c5f4e62159bfecee8c}{NoteToString}( \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) + \textcolor{stringliteral}{":"} + mKeyObjects[i].transform.
      position.ToString() );
273 
274                 \textcolor{comment}{// Set its parent.}
275                 key.\hyperlink{group___white_key_pub_func_gab926585e88db73a20431ac93d979b61d}{SetParentContainer}( \textcolor{keyword}{this} );
276             \}
277 
278             \textcolor{comment}{// Load the lesson marker.}
279             mLessonMarkers[i] = Instantiate( Resources.Load<GameObject>( LESSON\_MARKER\_PATH ) );
280             Assert.IsNotNull( mLessonMarkers[i], \textcolor{stringliteral}{"Could not load the lesson marker!"} );
281 
282             \textcolor{comment}{// Set the lesson marker position.}
283             mLessonMarkers[i].transform.SetParent( transform, \textcolor{keyword}{true} );
284             keyPosition.y += ( mKeyObjects[i].GetComponent<Renderer>().bounds.size.y / 2f ) + 0.001f;
285             keyPosition.x += ( mKeyObjects[i].GetComponent<Renderer>().bounds.size.x / 5f );
286             mLessonMarkers[i].transform.position = keyPosition;
287             mLessonMarkers[i].SetActive( \textcolor{keyword}{false} );
288 
289         \}
290     \}
291 
292     \textcolor{comment}{/*************************************************************************/}\textcolor{comment}{/** }
293 \textcolor{comment}{    * @\}}
294 \textcolor{comment}{    * @defgroup KeyContainHandlers Event Handlers}
295 \textcolor{comment}{    * @ingroup DocKeyContain}
296 \textcolor{comment}{    * Functions used internally by the KeyContainer to handle events.}
297 \textcolor{comment}{    * @\{}
298 \textcolor{comment}{    *****************************************************************************/}
299 \textcolor{comment}{}
300 \textcolor{comment}{    /**}
301 \textcolor{comment}{     * @brief Allows for other objects to toggle the audio.}
302 \textcolor{comment}{     * @param[in] aAudioEnabled Whether or not the audio should be enabled.}
303 \textcolor{comment}{    */}
304     \textcolor{keyword}{public} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga5fc6752f438bda64f0f860da0788fc13}{HandleAudioToggle}( \textcolor{keywordtype}{bool} aAudioEnabled )
305     \{
306         EnableAudio = aAudioEnabled;
307     \}
308 \textcolor{comment}{}
309 \textcolor{comment}{    /**}
310 \textcolor{comment}{    * @brief Handles a black key in the container being pressed.}
311 \textcolor{comment}{    * @param[in] aBlackKey The black key that was pressed.}
312 \textcolor{comment}{    */}
313     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga05cc2543fd9772b26e27bf4f6247ab47}{HandleBlackKeyPressed}( \hyperlink{class_black_key}{BlackKey} aBlackKey )
314     \{
315         \textcolor{keywordflow}{if}( EnableAudio && mVIM != null )
316         \{
317 \textcolor{preprocessor}{            #if DEBUG\_AUDIO\_DIAGNOSTICS}
318                 mVIM.\hyperlink{group___v_i_m_pub_func_ga7e60bc3c5464d8f34f0d56def675bcc6}{GetDiagnosticsHandler}().\hyperlink{group___audio_testing_a133561901c2aef535b2f3c098e55b959}{SetInputTime}.Invoke();
319 \textcolor{preprocessor}{            #endif}
320 
321             mVIM.\hyperlink{group___v_i_m_events_gaa21021c13a8c9d13cbf374d5bf9d68fa}{PlayNote}.Invoke( aBlackKey.\hyperlink{group___black_key_pub_var_gad233c456182c9cef7c01486484940439}{Pitch}, 100 );
322         \}
323     \}
324 \textcolor{comment}{}
325 \textcolor{comment}{    /**}
326 \textcolor{comment}{    * @brief Handles a black key in the container being released.}
327 \textcolor{comment}{    * @param[in] aBlackKey The black key that was released.}
328 \textcolor{comment}{    */}
329     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga5a0c5565c5ebc6026b3122f487e51704}{HandleBlackKeyReleased}( \hyperlink{class_black_key}{BlackKey} aBlackKey )
330     \{
331         \textcolor{keywordflow}{if}( EnableAudio && mVIM != null )
332         \{
333             mVIM.\hyperlink{group___v_i_m_events_ga3a1726a6366126421434c2c7be5e5678}{ReleaseNote}.Invoke( aBlackKey.\hyperlink{group___black_key_pub_var_gad233c456182c9cef7c01486484940439}{Pitch} );
334         \}
335     \}
336 \textcolor{comment}{}
337 \textcolor{comment}{    /** }
338 \textcolor{comment}{     * @brief Handles @link VirtualInstrumentManager::ChangeNoteRangeEvent a change in the note
       range@endlink.}
339 \textcolor{comment}{     * @param[in] aNewLowestPitch The lowest pitch of the new range.}
340 \textcolor{comment}{     * }
341 \textcolor{comment}{     * Sets the @link KeyContainer::mRepresentedPitches represented pitches@endlink and loads a new part of
       the keyboard for a changed note range.}
342 \textcolor{comment}{     * @sa VirtualInstrumentManager::ChangeNoteRangeEvent Music::PITCH}
343 \textcolor{comment}{    */}
344     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga0d82098e4f886f77a33f9d5ed13fe195}{HandleChangeNoteRangeEvent}( \hyperlink{class_music}{Music}.
      \hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH} aNewLowestPitch )
345     \{
346         \textcolor{comment}{// Clear the keyboard.}
347         \hyperlink{group___key_contain_priv_func_ga679f5ca9d6b1505180e90ee00bbfe616}{ClearKeyboard}();
348         mNumWhiteKeys = 0;
349 
350         \textcolor{comment}{// Update the represented pitches.}
351         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i = 0; i < \hyperlink{group___key_contain_const_gaa8fe6473e6396976e52c5793f027380e}{NUM\_KEYS}; i++ )
352         \{
353             \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] = (\hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH})( i + (\textcolor{keywordtype}{int})aNewLowestPitch )
      ;
354             \textcolor{keywordflow}{if}( !\hyperlink{class_music}{Music}.\hyperlink{group___music_stat_func_gacc2c1a66df7197225f61c5737f794065}{IsPitchABlackKey}( 
      \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) )
355             \{
356                 mNumWhiteKeys++;
357             \}
358         \}
359 
360         \textcolor{comment}{// Load the keys.}
361         \hyperlink{group___key_contain_priv_func_ga65f79700f265d2223681ac95981ab4a3}{LoadKeys}();
362     \}
363 \textcolor{comment}{}
364 \textcolor{comment}{    /**}
365 \textcolor{comment}{    * @brief Handles a white key in the container being pressed.}
366 \textcolor{comment}{    * @param[in] aWhiteKey The white key that was pressed.}
367 \textcolor{comment}{    */}
368     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga4e2c5e8be389a7514429910e7d61f028}{HandleWhiteKeyPressed}( \hyperlink{class_white_key}{WhiteKey} aWhiteKey )
369     \{
370         \textcolor{keywordflow}{if}( EnableAudio && mVIM != null )
371         \{
372 \textcolor{preprocessor}{            #if DEBUG\_AUDIO\_DIAGNOSTICS}
373                 mVIM.\hyperlink{group___v_i_m_pub_func_ga7e60bc3c5464d8f34f0d56def675bcc6}{GetDiagnosticsHandler}().\hyperlink{group___audio_testing_a133561901c2aef535b2f3c098e55b959}{SetInputTime}.Invoke();
374 \textcolor{preprocessor}{            #endif}
375 
376             mVIM.\hyperlink{group___v_i_m_events_gaa21021c13a8c9d13cbf374d5bf9d68fa}{PlayNote}.Invoke( aWhiteKey.\hyperlink{group___white_key_pub_var_ga1ddd98b85ba069defc7cf47d25f625f4}{Pitch}, 100 );
377         \}
378     \}
379 \textcolor{comment}{}
380 \textcolor{comment}{    /**}
381 \textcolor{comment}{    * @brief Handles a white key in the container being released.}
382 \textcolor{comment}{    * @param[in] aWhiteKey The white key that was released.}
383 \textcolor{comment}{    */}
384     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga5b98b0105300225fd79638525ad3cb3c}{HandleWhiteKeyReleased}( \hyperlink{class_white_key}{WhiteKey} aWhiteKey )
385     \{
386         \textcolor{keywordflow}{if}( EnableAudio && mVIM != null )
387         \{
388             mVIM.\hyperlink{group___v_i_m_events_ga3a1726a6366126421434c2c7be5e5678}{ReleaseNote}.Invoke( aWhiteKey.\hyperlink{group___white_key_pub_var_ga1ddd98b85ba069defc7cf47d25f625f4}{Pitch} );
389         \}
390     \}
391 \textcolor{comment}{}
392 \textcolor{comment}{    /**}
393 \textcolor{comment}{    * @brief Handler for when a song begins playing.}
394 \textcolor{comment}{    * @param[in] aSong The song that began playing.}
395 \textcolor{comment}{    */}
396     \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{group___key_contain_handlers_ga894c823059c5268af0954f83c04036ed}{HandlePlaySongEvent}( \hyperlink{class_song}{Song} aSong )
397     \{
398         \textcolor{comment}{// Keep track of the current key layout.}
399         \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH}[] currentLayout = \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches};
400 
401         \textcolor{comment}{// Get the highest note in the song.}
402         \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH} highestPitch = aSong.\hyperlink{group___song_pub_func_gafaa104e8653edf64148260ecd400570f}{GetHighestPitch}();
403 
404         \textcolor{comment}{// Get the lowest note in the song.}
405         \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH} lowestPitch = aSong.\hyperlink{group___song_pub_func_gae4e71c8eb059cc9cf0b77e78971ab326}{GetLowestPitch}();
406 
407         \textcolor{comment}{// Get the song data.}
408         \hyperlink{class_song}{Song}.\hyperlink{group___song_structs_struct_song_1_1_combined_note_data}{CombinedNoteData}[] noteData = aSong.\hyperlink{group___song_pub_func_gae3df1fd5448b7d9cefb0fed4af967985}{GetNoteData}();
409 
410         \textcolor{comment}{// Clear the keyboard.}
411         \hyperlink{group___key_contain_priv_func_ga679f5ca9d6b1505180e90ee00bbfe616}{ClearKeyboard}();
412 
413         \textcolor{comment}{// Set the range of keys.}
414         \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches} = null;
415         \textcolor{keywordtype}{int} numPitches = (int)highestPitch - (\textcolor{keywordtype}{int})lowestPitch + 1;
416         \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches} = \textcolor{keyword}{new} \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH}[numPitches];
417         mNumWhiteKeys = 0;
418         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i = 0; i < numPitches; i++ )
419         \{
420             \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] = (\hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH})( (\textcolor{keywordtype}{int})lowestPitch + i );
421             \textcolor{keywordflow}{if}( !\hyperlink{class_music}{Music}.\hyperlink{group___music_stat_func_gacc2c1a66df7197225f61c5737f794065}{IsPitchABlackKey}( 
      \hyperlink{group___key_contain_priv_var_ga103945a6efe3469191e5253d13fec5be}{mRepresentedPitches}[i] ) )
422             \{
423                 mNumWhiteKeys++;
424             \}
425         \}
426 
427         \textcolor{comment}{// Load the proper keys.}
428         \hyperlink{group___key_contain_priv_func_ga65f79700f265d2223681ac95981ab4a3}{LoadKeys}();
429 
430         \textcolor{comment}{// Get the sample interval (seconds between waveform samples.)}
431         \textcolor{keywordtype}{float} sampInt = \hyperlink{class_virtual_instrument}{VirtualInstrument}.\hyperlink{group___v_i_base_const_ga69a037919b64e1e3e0f2b949b2b6af2c}{SAMPLE\_INTERVAL};
432 
433         \textcolor{comment}{// Draw the lesson markers for each pitch.}
434         \textcolor{keywordflow}{foreach}( \hyperlink{class_song}{Song}.\hyperlink{group___song_structs_struct_song_1_1_combined_note_data}{CombinedNoteData} note in noteData )
435         \{
436             \textcolor{keywordflow}{if}( note.MelodyData.Pitches != null )
437             \{
438                 \textcolor{keywordflow}{foreach}( \hyperlink{class_music}{Music}.\hyperlink{group___music_enums_ga508f69b199ea518f935486c990edac1d}{PITCH} pitch in note.MelodyData.Pitches )
439                 \{
440                     StartCoroutine( \hyperlink{group___key_contain_handlers_gac6b82feca83eaf5e3ce6901088bc552c}{DrawLessonMarker}( (\textcolor{keywordtype}{int})pitch - (\textcolor{keywordtype}{int})lowestPitch, (\textcolor{keywordtype}{float}
      )note.TotalOffset * sampInt, ( note.MelodyData.NumSamples * sampInt ) - .02f ) );
441                 \}
442             \}
443         \}
444 
445     \}
446 \textcolor{comment}{}
447 \textcolor{comment}{    /**}
448 \textcolor{comment}{     * @brief Handles drawing the lesson markers.}
449 \textcolor{comment}{     * @param[in] aIndex The index of the key the draw the marker on.}
450 \textcolor{comment}{     * @param[in] aDelay The delay of when to draw the marker.}
451 \textcolor{comment}{     * @param[in] aStop How long the marker should be drawn.}
452 \textcolor{comment}{    */}
453     \textcolor{keyword}{private} IEnumerator \hyperlink{group___key_contain_handlers_gac6b82feca83eaf5e3ce6901088bc552c}{DrawLessonMarker}( \textcolor{keywordtype}{int} aIndex, \textcolor{keywordtype}{float} aDelay, \textcolor{keywordtype}{float} aStop )
454     \{
455         yield \textcolor{keywordflow}{return} \textcolor{keyword}{new} WaitForSeconds( aDelay );
456         mLessonMarkers[aIndex].SetActive( \textcolor{keyword}{true} );
457         yield \textcolor{keywordflow}{return} \textcolor{keyword}{new} WaitForSeconds( aStop );
458         mLessonMarkers[aIndex].SetActive( \textcolor{keyword}{false} );
459 
460         yield \textcolor{keywordflow}{return} null;
461     \}
462 \textcolor{comment}{}
463 \textcolor{comment}{    /** @\} */}
464 \}
\end{DoxyCodeInclude}
 